(this["webpackJsonpmovie-reminder"]=this["webpackJsonpmovie-reminder"]||[]).push([[6],{37:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(12),r=n(13),i="dc090ca63005b139171720979eb0186c",o=function(){function e(){Object(a.a)(this,e),this.apiBaseUrl="https://api.themoviedb.org/3",this.imageBaseUrl="https://image.tmdb.org/t/p"}return Object(r.a)(e,[{key:"getImageMovie",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return e?"".concat(this.imageBaseUrl,"/w").concat(t).concat(e):"".concat("","/placeholder.jpg")}},{key:"getActorProfile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return e?"".concat(this.imageBaseUrl,"/w").concat(t).concat(e):"https://via.placeholder.com/200x300"}},{key:"searchMovie",value:function(e,t){var n=this;return new Promise((function(a,r){var o="".concat(n.apiBaseUrl,"/search/movie?api_key=").concat(i,"&language=fr-FR&query=").concat(e,"&page=").concat(t);fetch(o).then((function(e){return e.json()})).then((function(e){7===e.status_code?r(e.status_message):a(e.results)}))}))}},{key:"getActorDetails",value:function(e){var t=this;return new Promise((function(n,a){var r="".concat(t.apiBaseUrl,"/person/").concat(e,"?api_key=").concat(i,"&language=fr-FR");fetch(r).then((function(e){return e.json()})).then((function(e){return e?n(e):a()}))}))}},{key:"getActorMovies",value:function(e){var t=this;return new Promise((function(n,a){var r="".concat(t.apiBaseUrl,"/person/").concat(e,"/movie_credits?api_key=").concat(i,"&language=fr-FR");fetch(r).then((function(e){return e.json()})).then((function(e){return e?n(e):a()}))}))}},{key:"getMovieDetail",value:function(e){var t=this;return new Promise((function(n,a){var r="".concat(t.apiBaseUrl,"/movie/").concat(e,"?api_key=").concat(i,"&language=fr-FR");fetch(r).then((function(e){return e.json()})).then((function(e){7===e.status_code?a(e.status_message):n(e)}))}))}},{key:"getMovieCredits",value:function(e){var t=this;return new Promise((function(n,a){var r="".concat(t.apiBaseUrl,"/movie/").concat(e,"/credits?api_key=").concat(i,"&language=fr-FR");fetch(r).then((function(e){return e.json()})).then((function(e){7===e.status_code?a(e.status_message):n(e)}))}))}}]),e}()},38:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(39),o=n.n(i);t.a=function(e){var t=null;return e.viewOnly||(t=r.a.createElement("button",{onClick:function(){return e.addToFavorite(e.movie)},className:"btn-action add-to-favorites"},"Ajouter"),(e.onlyDelete||e.movie.inFav)&&(t=r.a.createElement("button",{onClick:function(){return e.deleteMovieFromFavorites(e.movie)},className:"btn-action remove-from-favorites"},"Supprimer"))),r.a.createElement("li",{className:"movie-card"},navigator.onLine&&r.a.createElement("img",{src:e.movieImage,onClick:function(){return e.seeMovieDetails(e.movie.id)},alt:"Affiche de ".concat(e.movie.title),className:"movie-card__img cursorPointer"}),r.a.createElement("p",{className:"movie-card__title"},e.movie.title),r.a.createElement("p",{className:"movie-card__release"},o()(e.movie.release_date).format("DD/MM/YYYY")),r.a.createElement("div",{className:"movie-card__action"},e.indexedDbSupported&&t,navigator.onLine&&r.a.createElement("button",{onClick:function(){return e.seeMovieDetails(e.movie.id)},className:"btn-action movie-details"},"D\xe9tails")))}},40:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var a=n(35),r=n.n(a),i=n(36),o=n(42),c=function(){var e=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(o.a)("movies",1,{upgrade:function(e,t,n){var a=e.createObjectStore("favorites",{keyPath:"id",autoIncrement:!0});a.createIndex("title","title"),a.createIndex("movieId","movieId")}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t.id,o=t.title,s=t.overview,u=t.poster_path,l=t.release_date;c().then(function(){var t=Object(i.a)(r.a.mark((function t(i){var c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.getAllFromIndex("favorites","title");case 2:if(c=t.sent,c.find((function(e){return e.movieId===a}))){t.next=10;break}return t.next=7,i.add("favorites",{movieId:a,title:o,overview:s,poster_path:u,release_date:l});case 7:e(),t.next=11;break;case 10:n("Movie always in DB");case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){console.error(e),n(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){c().then(function(){var n=Object(i.a)(r.a.mark((function n(a){var i;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.getKeyFromIndex("favorites","movieId",t);case 2:return i=n.sent,n.next=5,a.delete("favorites",i);case 5:e();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},50:function(e,t,n){"use strict";n.r(t);var a=n(35),r=n.n(a),i=n(41),o=n(36),c=n(12),s=n(13),u=n(14),l=n(15),v=n(0),m=n.n(v),f=n(5),d=function(e){return m.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"loading",width:e.width,height:e.height,viewBox:"0 0 100 100"},m.a.createElement("circle",{cx:"50",cy:"23",r:"13",fill:"#ffffff"},m.a.createElement("animate",{attributeName:"cy",dur:"2s",repeatCount:"indefinite",calcMode:"spline",keySplines:"0.45 0 0.9 0.55;0 0.45 0.55 0.9",keyTimes:"0;0.5;1",values:"23;77;23"})))},h=n(38),p=n(40),g=n(37),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).keyPress=function(e){return 13===e.keyCode&&a.searchMovie()},a.searchMovie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;a.setState({loading:!0,moviesNotFound:!1}),setTimeout((function(){a.movieFinder.searchMovie(a.state.search,e).then(function(){var e=Object(o.a)(r.a.mark((function e(t){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=3;break}return a.setState({moviesNotFound:!0}),e.abrupt("return");case 3:return e.next=5,a.state.db.getAllFromIndex("favorites","title");case 5:n=e.sent,o=t.map((function(e){return Object(i.a)({},e,{inFav:n.some((function(t){return t.movieId===e.id}))})})),a.setState({movies:o});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e)})).finally((function(){return a.setState({loading:!1})}))}),1e3)},a.addMovieInFavAndRegenerateList=function(e){Object(p.a)(e).then((function(){var t=Object.assign(e,{inFav:!0}),n=a.state.movies.findIndex((function(t,n){return t.id===e.id}));a.state.movies.splice(n,1,t),a.setState({movies:a.state.movies})})).catch((function(e){console.error(e)}))},a.deleteMoviefromFavAndRegenerateList=function(e){Object(p.b)(e.id).then((function(){delete e.inFav;var t=a.state.movies.findIndex((function(t,n){return t.id===e.id}));a.state.movies.splice(t,1,e),a.setState({movies:a.state.movies})})).catch((function(e){console.error(e)}))},a.generateMoviesList=function(e){return e.map((function(e){return m.a.createElement(h.a,{movieImage:a.movieFinder.getImageMovie(e.poster_path,200),movie:e,key:"".concat(e.id,"-").concat(e.release_date),indexedDbSupported:a.state.indexedDbSupported,addToFavorite:a.addMovieInFavAndRegenerateList,deleteMovieFromFavorites:a.deleteMoviefromFavAndRegenerateList,seeMovieDetails:function(){return a.seeMovieDetails(e.id)}})}))},a.seeMovieDetails=function(e){return a.props.history.push("/movie/".concat(e))},a.searchResetState=function(){return a.state.loading?m.a.createElement(d,{width:"25px",heigth:"25px"}):m.a.createElement("div",{className:"reset-search ".concat(a.state.search.length<=2?"disabledBtn":""),onClick:function(){return a.setState({movies:[],search:"",moviesNotFound:!1})}},m.a.createElement("span",null,"+"))},a.seeOtherPage=function(e){window.scroll({top:0,left:0,behavior:"smooth"}),1===e?a.setState((function(e){return{currentPage:e.currentPage+1}}),(function(){a.searchMovie(a.state.currentPage)})):a.setState((function(e){return{currentPage:e.currentPage-1}}),(function(){a.searchMovie(a.state.currentPage)}))},a.state={db:null,search:"",movies:[],moviesNotFound:!1,indexedDbSupported:"indexedDB"in window,loading:!1,currentPage:1},a.movieFinder=new g.a,a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(p.c)().then((function(t){e.setState({db:t})})).catch((function(e){console.error(e)}))}},{key:"render",value:function(){var e=this;return m.a.createElement("section",{className:"search-page"},m.a.createElement("h1",null,"Rechercher un film"),m.a.createElement("div",{className:"search"},m.a.createElement("div",null,m.a.createElement("input",{type:"text","aria-label":"Bouton de recherche d'un film",placeholder:"Shutter island...",onChange:function(t){return e.setState({search:t.target.value})},onKeyDown:this.keyPress,value:this.state.search,className:"search-input ".concat(this.state.search.length>2?"usable":"")}),this.searchResetState()),m.a.createElement("button",{onClick:this.searchMovie,className:"search-action ".concat(this.state.search.length<=2?"disabledBtn":"")},"Rechercher")),!this.state.indexedDbSupported&&m.a.createElement("p",null,"Vous devriez utiliser un navigateur moderne pour pouvoir enregistrer vos films pr\xe9f\xe9r\xe9s"),this.state.moviesNotFound?m.a.createElement("p",null,"Aucun film ne correspond \xe0 votre cherche :("):m.a.createElement("div",{className:"movies-section"},m.a.createElement("div",{className:"movies-list"},m.a.createElement("ul",{className:"layout-list"},this.generateMoviesList(this.state.movies))),m.a.createElement("div",{className:"pagination"},this.state.currentPage>1&&m.a.createElement("p",{className:"pagination__prev cursorPointer",onClick:function(){return e.seeOtherPage(-1)}},"Pr\xe9c\xe9dent"),this.state.movies.length>0&&m.a.createElement("p",{className:"cursorPointer",onClick:function(){return e.seeOtherPage(1)}},"Suivant"))))}}]),n}(m.a.Component);t.default=Object(f.f)(b)}}]);
//# sourceMappingURL=6.d02e6a54.chunk.js.map